{% extends 'widgets/refactor_art.html' %}
  {% block side_bar %}
  <div class="col-lg-3">
    <div class="side-menu">
      <div class="side-menu__content">
        <div class="side-menu__links side-menu__links--main">
          {% if feincms_page.show_help %}
            <a class="link link--medium-blue" href="{% url 'help_pdf' %}"
              ><p>Первая помощь</p></a
            >
          {% endif %}
          {% for link in feincms_page.cross_link.all %}
            <a class="link link--medium-blue" href="/{{link.slug}}"
              ><p>{{link.title}}</p></a
            >
          {% endfor %}
        </div>
        <div class="side-menu__links">
          {% for i in feincms_page.content.main %}
            <a class="link link--green" href="#{{ i.title }}"><p>{{ i.title }}</p></a>
          {% endfor %}
          {% for i in feincms_page.content.sections %}
            {% if i.title %}
              <a class="link link--green" href="#{{i.title}}"><p>{{i.title}}</p></a>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div class="col-lg-6">
    <div class="article article__organization">
      <div class="article__image-wrapper aspect-ratio">
        <img src="https://via.placeholder.com/1140x764" alt="" />
        <a class="article__image-caption" href="/" target="__blank">
          <p>
            {{org.title}}
          </p>
        </a>
      </div>
      <div class="article__organization__info">
        <div class="article__organization__info__item">
          <div class="article__organization__info__desc">
            <div class="icon-wrapper">
              <i class="icon-map-marker-green"></i>
            </div>
            <p>Расположение</p>
          </div>
          <div class="article__organization__info__content">
            <span>{{org.adress}}</span>
          </div>
        </div>
        <div class="article__organization__info__item">
          {% if org.organizationservices_set.all %}
            <div class="article__organization__info__desc">
              <div class="icon-wrapper"><i class="icon-card"></i></div>
              <p>Услуги</p>
            </div>
            <div class="article__organization__info__content">
              <ul>
                {% for l in org.organizationservices_set.all %}
                  <li><span>{{l.org_type.title}}</span></li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3">
    <div class="information-side">
      <div class="information-block">
        <div class="quiz">
          <h1 class="information-block__title headline-1">Анкеты</h1>
            <div class="information-block__text">
              <p><strong>{{widget.title}}</strong></p>
                {{widget.text|safe}}
            </div>
            <div class="quiz-item">
              <br>
            {% for q in quiz %}
            <form id="form_{{q.id}}" class="form_quiz" name="question_form" action="{% url 'get_answer' %}">
              <input hidden name="answer_for" value="{{q.title}}">
              <p class="quiz-item__title">
                {{q.title}}
              </p>
              <div class="quiz-item__content">
                {% for choice in q.get_choices %}
                  <div class="quiz-item__radio">
                    <p>
                      <input
                      type="radio"
                      name="{{q.title}}"
                      value="{{choice}}"
                      id="{{choice.id}}"
                      />
                      <label for="{{choice.id}}">{{choice.title}}</label>
                    </p>
                  </div>
                {% endfor %}

                <button
                  type="submit"
                  class="quiz-item__button btn quiz-item__button"
                  id="button_{{q.id}}"
                  name="submit_answer"
                >
                  Голосовать
                </button>
              </div>
              <button
                type="button"
                class="quiz-item__button quiz-item__button--transparent"
                id="show_form_{{q.id}}"
              >
                Показать результаты
              </button>
            </form>
            <div id="res_form_{{q.id}}" style="display: none" class="quiz-item quiz-item--done">
              <div class="quiz-item__content">
                <div class="quiz-item__result">
                  {% for answ, res in q.get_percent.items %}
                    <p class="quiz-item__result__title">
                        {{answ}} ({{res.0}}%, {{res.1}} голосов) (72%, 129 голосов)
                      </p>
                      <div
                        class="quiz-item__result__progress"
                        style="width: {{res.0}}%"
                      ></div>
                  {% endfor %}
                </div>
              </div>
              <div class="quiz-item__all">
                <p>Всего проголосовавших:<strong>{{q.get_amount.all}}</strong></p>
              </div>
            </div>
          {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="organizations__map">
    <div class="organizations__map-contact">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="organizations__map-contact__content">
              <div class="organizations__map-contact__item">
                <p class="title">Адрес</p>
                <div class="desc">
                  <p>{{org.adress}}</p>
                </div>
              </div>
              <div class="organizations__map-contact__item">
                <p class="title">Время работы</p>
                {% if org.working_hours %}
                  <div class="desc">
                    <p>{{org.working_hours}}</p>
                  </div>
                {% endif %}
              </div>
              <div class="organizations__map-contact__item">
                <p class="title">Телефоны</p>
                {% if org.tel1 %}
                  <div class="desc">
                    <a href="tel:{{org.tel1}}"><p>{{org.tel1}}</p></a>
                  </div>
                {% endif %}
                {% if org.tel2 %}
                  <div class="desc">
                    <a href="tel:{{org.tel2}}"><p>{{org.tel2}}</p></a>
                  </div>
                {% endif %}
                {% if org.tel3 %}
                  <div class="desc">
                    <a href="tel:{{org.tel3}}"><p>{{org.tel3}}</p></a>
                  </div>
                {% endif %}
              </div>
              <div class="organizations__map-contact__item">
                <p class="title">Сайт</p>
                {% if org.website %}
                  <div class="desc">
                    <a href="/" target="__blank"
                      ><p>{{org.website}}</p></a
                    >
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="/static/js/jquery-3.5.1.min.js"></script>
  <script>
    $('document').ready(function () {
        console.log('test')
        $('.quiz-item__button--transparent').on('click', function () {
            form_id = this.id.slice(5)
            console.log(form_id);
            $('#res_' + form_id).toggle();

        });

        $('.form_quiz').submit(function(fun){
            fun.preventDefault();
            form_id = this.id;
            $.ajax({
              url: '{% url 'get_answer' %}',
              data: $('#' + form_id).serialize(),
              success: function(){
                  $('#' + form_id).toggle();
                  $('#res_' + form_id).toggle();
              }
            });
        });
    })
  </script>
{% endblock %}

